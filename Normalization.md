# 릴레이션 정규화

> 데이터베이스의 테이블(릴레이션)을 설계하다보면 **속성들간의 연관성이 존재하는 경우**가 많다. 이러한 관계를 고려하지 않고 테이블을 설계할 경우 후에 로직을 구현할 때 어려움을 겪는 경우가 많다.
>

## 함수 종속

### Functional Dependency (함수 종속)

- DB의 릴레이션에서 **두 개의 속성 집합 간의 제약**
- X → Y (X , Y : R 안에서 속성의 집합들)
    - 각각의 X 값에 대하여 최대 한 개의 Y값에 연관되어 있는 경우 (**X : 결정자 , Y : 종속자**)
- **중고차 거래 시스템에서 유저(사용자) 테이블을 예시**
    - 사용자는 고유 번호인 user_id와 매너 온도인 manner_temperature 속성을 가진다. 이 둘의 함수 종속성은?

      **user_id → manner_temperature**


### 정규화

- 이상현상이 있는 **릴레이션을 분해**하여 이를 해결하는 과정 (분해하는 것이 키포인트 !)

### 이상현상(Anomaly)

1. 갱신 이상 : 반복된 데이터에 대해 **일부를 갱신 할 경우 데이터 불일치** 발생
2. 삽입 이상 : **불필요한 정보를 함께 저장**하지 않고는 **정보를 저장하는 것이 불가능**한 경우
3. 삭제 이상 : **불필요한 정보를 함께 삭제**하지 않고는 **정보 삭제가 불가능**한 경우

### EX

- 회사의 사원 테이블 (부서가 중복이 가능한  小기업 ㅎㄷㄷㄷ)

| 회원번호 | 이름 | 직군 | 부서 |
| --- | --- | --- | --- |
| 1 | 박준우 | FE | 중고차 |
| 2 | 김승진 | BE | 중고차 |
| 2 | 김승진 | BE | 회원관리 |
- **갱신 이상 (김승진의 직군이 BE → DevOps로 변경?)**

  2번째 행과 3번째 행 모두를 바꿔야 한다. 2번째 행만 바꾼다면?

- **삽입 이상 (IOS 부서가 신설되었지만 아직 사원을 뽑지 않았다면?)**

  불필요한 정보를 기입하지 않는다면 정보를 저장할 수 없다.

- **삭제 이상 (우리 회사의 유일한 FE 개발자 박준우가 더 좋은 오퍼를 받고 회사를 이직한다면?)**

  FE에 대한 모든 정보가 사라지게 된다.

- 이러한 이상현상(Anomaly)를 해결하고 싶다면 ?
    - **Normalization**

### 장점

1. 데이터 베이스의 이상현상을 해결 할 수 있다.
2. 정규화된 데이터베이스 구조에서 새로운 데이터 추가시 구조를 변경하지 않아도 된다.
3. 데이터의 추가 , 변경 , 삭제 시 → 전파되는 범위가 적기 때문에 안정적이라고 할 수 있다.

### 단점

1. 테이블의 수가 증가하게 된다. (분해라는 것은 새로운 테이블을 추가하는 것과 동일) → 이로 인한 **JOIN 연산의 수가 증가**한다.
    - 조인 연산은 데이터 베이스의 연산에서 비용이 큰 연산이다. (성능과 관련이 있기 때문에 주의하여 설계 필요)

# 정규화 단계

> 하나의 칼럼이 복수개의 값을 가질 수 있다면 생기는 문제는 뭐가 있을까?
>
- **문제 ?**

  특정 데이터를 수정하는 경우에 문제가 발생할 수 있다.


## 1NF

- 테이블의 칼럼이 **원자값을 가지도록 테이블을 분해**하는 것 !
    - 칼럼은 단 한개의 원자값 , 모두 동일한 타입(자료형)을 가져야 한다.
    - 칼럼의 순서는 고려되어서는 안된다.

**(EX**

- 차량 정보 관리 테이블 (사용자가 복수개의 차량을 가진 경우)

| 사용자ID | 소유차량ID | 이름 | 성별 |
| --- | --- | --- | --- |
| 1 | 1,2,3 | 박준우 | M |
| 2 | 4 | 김승진 | M |
| 3 | 5 | 진주원 | M |
- 제 1정규화 단계를 거친다면 !

| 사용자ID | 소유차량ID | 이름 | 성별 |
| --- | --- | --- | --- |
| 1 | 1 | 박준우 | M |
| 1 | 2 | 박준우 | M |
| 1 | 3 | 박준우 | M |
| 2 | 4 | 김승진 | M |
| 3 | 5 | 진주원 | M |

## 2NF

- 제 1정규형인 테이블에 대하여 **완전** **함수 종속을 만족**하도록 테이블을 분해하는 것
    1. 제 1 정규화를 만족해야 한다.
    2. 모든 컬럼의 **부분적 종속이 존재해서는 안된다.**

### 부분적 종속(Partial Dependency)

- 기본키가 복합키인 경우 **기본키의 일부 속성만으로 종속**되는 경우(기본키의 일부만으로 결정자를 구성할 수 있는 경우)

**(EX**

- 차량 정보 관리 테이블

| 사용자ID | 소유차량ID | 이름 | 성별 | 차종 |
| --- | --- | --- | --- | --- |
| 1 | 1 | 박준우 | M | 람보르기니 우르스 |
| 1 | 2 | 박준우 | M | VOLVO |
| 1 | 3 | 박준우 | M | 벤츠 S클래스 |
| 2 | 4 | 김승진 | M | 포르쉐 911 |
| 3 | 4 | 진주원 | M | 포르쉐 911 |
- 위 테이블에서 **부분적 종속**
    - 기본키는 (사용자ID + 소유차량ID)의 조합이다. 해당 기본키는 이름, 성별, 차종을 결정한다.
        - **사용자ID**만으로 **이름과 성별**을 결정한다.
        - **소유차량ID**만으로 **차종**을 결정한다.

### 완전 함수 종속

- 종속자가 기본키에만 종속되며 **기본키가 복합인 경우 모든 속성이 포함된 기본키의 부분집합에 종속**된 경우

| 사용자ID | 이름 | 성별 |
| --- | --- | --- |
| 1 | 박준우 | M |
| 2 | 김승진 | M |
| 3 | 진주원 | M |

| 소유차량ID | 사용자ID |
| --- | --- |
| 1 | 1 |
| 2 | 1 |
| 3 | 1 |
| 4 | 2 |
| 4 | 3 |

| 소유차량ID | 차종 |
| --- | --- |
| 1 | 람보르기니 우르스 |
| 2 | VOLVO |
| 3 | 벤츠 S클래스 |
| 4 | 포르쉐 911 |

## 3NF

- 2정규화가 진행된 테이블에 대해 **이행적 종속을 없애도록 테이블을 분해**하는 것

### 이행적 종속

- A → B , B→ C가 만족할 때 A → C가 성립되는 것

**Ex)**

| 닉네임(중복 불가) | 차종 | 차량 배기량(cc) |
| --- | --- | --- |
| 진주원 | 람보르기니 우르스 | 300 |
| 김승진 | VOLVO | 400 |
| 박준우 | 벤츠 S클래스 | 500 |
- 위 테이블에서 이행적 종속
    - 사용자이름 → 차종 , 차종 → 배기량
    - **닉네임 → 차량 배기량**
- **이행적 종속 관계의 이상현상**

  대표적으로 위의 예시로 설명하자면 **갱신 이상**이 있을 수 있다.

  특정 차종의 차량 배기량이 잘못 기입되어 있어 수정이 필요할 때 모든 데이터를 수정해야 한다 !


| 닉네임 | 차종 |
| --- | --- |
| 진주원 | 람보르기니 우르스 |
| 김승진 | VOLVO |
| 박준우 | 벤츠 S클래스 |

| 차종 | 차량 배기량(cc) |
| --- | --- |
| 람보르기니 우르스 | 300 |
| VOLVO | 400 |
| 벤츠 S클래스 | 500 |

## BCNF

- 제 3 정규형을 만족해야 한다.
- 모든 결정자가 후보키 집합에 속해야 한다.
- **후보키?**

  테이블에서 행을 유일하게 식별할 수 있는 최소한의 속성들의 집합 ( 기본키가 가능한 집합군 )


> 결정자를 통해 다른 속성의 값이 결정된다. 후보키가 아닌 결정자가 테이블에 있다는 것은 말 그대로 중복된 데이터가 존재한다는 것이다. 이러한 것은 **갱신 이상**을 발생시킬 수 있다.
>

**Ex) 연습생 테이블 (한명의 멘토당 하나의 과목만 가르칠 경우)**

| 연습생명 | 과목명 | 담당 멘토 | 월말평가성적 |
| --- | --- | --- | --- |
| 진주원 | 랩 | RM | S(다음달 데뷔) |
| 박준우 | 랩 | J-Hope | A |
| 김승진 | 춤 | 제니 | A |
| 진주투 | 춤 | 제니 | A |
- **갱신 이상?**

  제니가 춤이 아닌 보컬을 가르칠 경우 ? : 테이블의 모든 행을 변경해야 한다.

- **삭제 이상?**

  RM이 유일하게 가르치는 연습생이 진주원이라 가정하자. 진주원이 다음달에 데뷔하여 더이상 연습생이 아니게 된다면? : RM에 대한 정보도 전부 삭제된다.

- **삽입 이상?**

  새로운 멘토인 리사가 추가된다 하자 : 하지만 담당 연습생이 없기 때문에 해당 정보를 저장할 수 없다.


### 참고

[함수 종속성(완전 함수 종속, 부분함수 종속, 이행함수 종속)의 개념](https://developer111.tistory.com/8)

[데이터 정규화가 뭔지 설명해보세요 (개발면접타임)](https://www.youtube.com/watch?v=Y1FbowQRcmI)

[[DB] 8. 정규형 (1NF, 2NF, 3NF, BCNF)](https://rebro.kr/160)
